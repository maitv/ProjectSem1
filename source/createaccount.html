<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<link rel="stylesheet" href="js/jquery.mobile-1.4.2/jquery.mobile-1.4.2.min.css">
<script src="js/jquery-1.11.0.min.js"></script>
<script src="js/jquery.mobile-1.4.2/jquery.mobile-1.4.2.min.js"></script>
<script src="js/jquery-1.11.0.min.js"></script>
<script src="js/common.js"></script>

<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
</head>
<body>
    <div id="movies" data-role="page" >
        <div data-role="header" data-id="persistheader" 
        data-position="fixed">
	        <h1>Tạo tài khoản</h1>
    	</div>
        <div data-role="content">            
            <form action="#" method='post'>
               <input type='text' id='txtAccountDisplay' name='txtAccountDisplay' placeholder='Nhập vào tên tài khoản' value='' />
               <input type='number' id='txtAccountBalance' name='txtAccountBalance' placeholder='Nhập vào số tiền của tài khoản' />
               <input type="text" data-role="date" id="dateTrans" placeholder='Ngày bắt đầu'>
        </div>
        <div data-role="footer" data-id="persistfooter" data-position="fixed" >
            <div data-role="navbar">
                <ul>
                	<li><input type="submit" value="Tạo tài khoản" onClick="onCreateAccount()"></li>
                    <li><input type="reset" value="Hủy bỏ" onClick="onReset()"></li>
                </ul>
            </div>
            </form>
        </div>
	</div>
</body>
</html>
<script>
	$(document).ready(function(){
		$("#dateTrans").datepicker();
	});	
	
	// Open db
	var db = window.openDatabase("myDatabase", "1.0", "My WebSQL database", 5*1024*1024);
	
	if(!db) {
		// Check DB was created
		alert('Your DB was not created this time');
	}
	/*
	function onReadyTransaction( ){
		console.log( 'Transaction completed' )
	}
	
	function onSuccessExecuteSql( tx, results ){
		console.log( 'Execute SQL completed' )
	}
	*/
	
	function onReset(){
		// reset all data in form
		document.getElementById('txtAccountDisplay').value = "";
		document.getElementById('txtAccountBalance').value = "";
		document.getElementById('dateTrans').value = "";
	}
	
	function validatation(){
		if (document.getElementById('txtAccountDisplay').value == "" ||
		document.getElementById('txtAccountBalance').value == "" ||
		document.getElementById('dateTrans').value == ""
		)
		{
			return false;
		}
		
		return true;
	}
	
	function onSuccessCreateAccount(){
		// create account success => redirect to mainpage.html
		window.location.href = 'mainpage.html';
	}
	
	function onCreateAccount(){
		var accountDisplay = "";
		var accountBalance = 0;
		
		if(!validatation()){
			alert('Bạn chưa nhập tên/số tiền/ngày bắt đầu !');
			return false;
		}
		
		accountDisplay = document.getElementById('txtAccountDisplay').value ;
		accountDisplay = accountDisplay.trim();
		accountBalance = parseInt(document.getElementById('txtAccountBalance').value);
		dateTrans = document.getElementById('dateTrans').value;
		
		db.transaction(
					function(tx){				
						tx.executeSql(
						"INSERT INTO AccountInfo(AccountDisplay, AccountBalance, CurrencyUnit) VALUES(?, ?, ?)",
						[accountDisplay, accountBalance, 'Việt Nam Đồng'],
						function(tx, results){
							accID = results.insertId;
							
							db.transaction(
								function(tx){				
										tx.executeSql(
										"INSERT INTO Transactions(Amount, Description, CategoryID, TransactionDate) VALUES(?, ?, ?, ?)",
										[accountBalance, "Khởi tạo tài khoản", 7, dateTrans],
										onSuccessCreateAccount,
										onErrorCommon
									)
								},
								onErrorCommon,
								onReadyTransaction
							);
						},
						onErrorCommon
					)
				},
				onErrorCommon,
				onReadyTransaction
			);
	}
</script>